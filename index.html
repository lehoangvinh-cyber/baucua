<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Game Center: Báº§u Cua, TÃ i Xá»‰u, XÃ³c ÄÄ©a, Äua Ngá»±a</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #d32f2f; --gold: #ffc107; --bg: #1a1a1a; --dark-card: #2c2c2c; --green: #2e7d32; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; display: flex; justify-content: center; }
        
        .game-container { width: 100%; max-width: 1100px; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
        @media (max-width: 900px) { .game-container { grid-template-columns: 1fr; } }
        
        .main-panel { background: var(--dark-card); padding: 20px; border-radius: 20px; border: 2px solid var(--gold); min-height: 600px; position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 12px; border-radius: 12px; margin-bottom: 20px; }
        
        /* Menu */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 30px; }
        .menu-item { background: #333; border: 2px solid #444; border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; }
        .menu-item:hover { border-color: var(--gold); transform: translateY(-3px); }
        .menu-item img { width: 60px; height: 60px; margin-bottom: 10px; }

        /* Game Boards Chung */
        .dice-board { display: flex; justify-content: center; gap: 15px; margin: 20px 0; background: #444; padding: 20px; border-radius: 15px; min-height: 100px; align-items: center; }
        .dice-board img { width: 65px; height: 65px; background: white; border-radius: 10px; }
        
        /* XÃ³c ÄÄ©a Dots */
        .xd-dot { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #333; }
        .dot-red { background: #ff5252; }
        .dot-white { background: #ffffff; }

        /* Äua Ngá»±a Track */
        .track { background: var(--green); padding: 10px; border-radius: 10px; position: relative; overflow: hidden; }
        .lane { height: 40px; border-bottom: 1px dashed rgba(255,255,255,0.2); position: relative; display: flex; align-items: center; }
        .horse { font-size: 24px; position: absolute; left: 0; transition: left 0.2s linear; }

        /* Sidebar & Chat */
        .box { background: #252525; border-radius: 15px; border: 1px solid #444; margin-bottom: 15px; overflow: hidden; }
        #chat-messages { height: 350px; overflow-y: auto; padding: 15px; font-size: 13px; scroll-behavior: smooth; }
        #chat-messages::-webkit-scrollbar { width: 5px; }
        #chat-messages::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
        .chat-time { font-size: 10px; color: #777; margin-right: 5px; }

        /* Utility */
        .hidden { display: none; }
        .shaking { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: rotate(3deg); } 50% { transform: rotate(-3deg); } }
        #play-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .active-bet { border: 2px solid var(--gold) !important; background: #444 !important; }
    </style>
</head>
<body>

<div id="auth-screen" style="margin-top: 100px; text-align: center;">
    <h1 style="color: var(--gold);">MULTI-GAME CENTER</h1>
    <button onclick="login()" style="padding: 15px 40px; font-size: 18px; cursor: pointer; border-radius: 10px;">ğŸ”‘ ÄÄƒng nháº­p Google</button>
</div>

<div id="game-ui" class="game-container hidden">
    <div class="main-panel">
        <div class="header">
            <div>ğŸ‘‹ <b id="user-name">...</b></div>
            <div style="color: var(--gold); font-size: 20px;">ğŸ’° <b id="balance">0</b></div>
            <button onclick="logout()" style="background:none; color:#888; border:none; cursor:pointer;">ThoÃ¡t</button>
        </div>

        <div id="msg" style="text-align:center; font-weight:bold; height: 25px; color: var(--gold);"></div>

        <div id="screen-menu">
            <div class="menu-grid">
                <div class="menu-item" onclick="changeScreen('bc')"><img src="https://cdn-icons-png.flaticon.com/512/2329/2329865.png"><br>Báº§u Cua</div>
                <div class="menu-item" onclick="changeScreen('tx')"><img src="https://cdn-icons-png.flaticon.com/512/3554/3554832.png"><br>TÃ i Xá»‰u</div>
                <div class="menu-item" onclick="changeScreen('xd')"><img src="https://cdn-icons-png.flaticon.com/512/1046/1046368.png"><br>XÃ³c ÄÄ©a</div>
                <div class="menu-item" onclick="changeScreen('dn')"><img src="https://cdn-icons-png.flaticon.com/512/3462/3462140.png"><br>Äua Ngá»±a</div>
            </div>
        </div>

        <div id="screen-bc" class="hidden">
            <button onclick="changeScreen('menu')">â† Menu</button>
            <div class="dice-board" id="board-bc">
                <img id="dice-bc-0" src="https://img.icons8.com/color/144/help.png">
                <img id="dice-bc-1" src="https://img.icons8.com/color/144/help.png">
                <img id="dice-bc-2" src="https://img.icons8.com/color/144/help.png">
            </div>
            <div class="betting-table" id="bet-bc-area" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;"></div>
        </div>

        <div id="screen-tx" class="hidden">
            <button onclick="changeScreen('menu')">â† Menu</button>
            <div class="dice-board">
                <img id="dice-tx-0" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
                <img id="dice-tx-1" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
                <img id="dice-tx-2" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
            </div>
            <div style="display:flex; gap:10px;">
                <div id="btn-tai" style="flex:1; background:#333; padding:20px; text-align:center; border-radius:10px; cursor:pointer;" onclick="selTX('tai')"><h2>TÃ€I</h2><input type="number" id="val-tai" placeholder="Sá»‘ xu..."></div>
                <div id="btn-xiu" style="flex:1; background:#333; padding:20px; text-align:center; border-radius:10px; cursor:pointer;" onclick="selTX('xiu')"><h2>Xá»ˆU</h2><input type="number" id="val-xiu" placeholder="Sá»‘ xu..."></div>
            </div>
        </div>

        <div id="screen-xd" class="hidden">
            <button onclick="changeScreen('menu')">â† Menu</button>
            <div class="dice-board" id="board-xd" style="gap:20px;">
                <div id="dot-0" class="xd-dot dot-white"></div><div id="dot-1" class="xd-dot dot-white"></div>
                <div id="dot-2" class="xd-dot dot-white"></div><div id="dot-3" class="xd-dot dot-white"></div>
            </div>
            <div style="display:flex; gap:10px;">
                <div id="btn-chan" style="flex:1; background:#333; padding:20px; text-align:center; border-radius:10px; cursor:pointer;" onclick="selXD('chan')"><h2>CHáº´N</h2><input type="number" id="val-chan" placeholder="Sá»‘ xu..."></div>
                <div id="btn-le" style="flex:1; background:#333; padding:20px; text-align:center; border-radius:10px; cursor:pointer;" onclick="selXD('le')"><h2>Láºº</h2><input type="number" id="val-le" placeholder="Sá»‘ xu..."></div>
            </div>
        </div>

        <div id="screen-dn" class="hidden">
            <button onclick="changeScreen('menu')">â† Menu</button>
            <div class="track" style="margin:20px 0;">
                <div class="lane"><div id="horse-0" class="horse">ğŸ‡1</div></div>
                <div class="lane"><div id="horse-1" class="horse">ğŸ‡2</div></div>
                <div class="lane"><div id="horse-2" class="horse">ğŸ‡3</div></div>
                <div class="lane"><div id="horse-3" class="horse">ğŸ‡4</div></div>
            </div>
            <div id="bet-dn-area" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px;"></div>
        </div>

        <button id="play-btn" class="hidden" onclick="masterPlay()">Báº®T Äáº¦U PHIÃŠN (HOST)</button>
    </div>

    <div class="side-panel">
        <div class="box"><div style="padding:10px; font-weight:bold; color:var(--gold);">ğŸŸ¢ ONLINE (<span id="online-count">0</span>)</div><ul id="user-list" style="list-style:none; padding:10px; margin:0; font-size:12px;"></ul></div>
        <div class="box"><div id="chat-messages"></div><div class="chat-input-area"><input type="text" id="chat-input" placeholder="Chat..."><button onclick="sendChat()">></button></div></div>
    </div>
</div>

<script>
    // --- CONFIG FIREBASE ---
    const firebaseConfig = { apiKey: "AIza...", authDomain: "...", databaseURL: "...", projectId: "...", storageBucket: "...", messagingSenderId: "...", appId: "..." };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.database();

    let curScreen = 'menu'; let balance = 0; let isHost = false; let currentUser = null;
    let myBets = { bc: [0,0,0,0,0,0], tx: {type:null, val:0}, xd: {type:null, val:0}, dn: [0,0,0,0] };

    const itemsBC = [{n:'Báº§u',i:'2329865'},{n:'Cua',i:'1046368'},{n:'TÃ´m',i:'2515183'},{n:'CÃ¡',i:'2271313'},{n:'GÃ ',i:'2632839'},{n:'Nai',i:'2395796'}];
    itemsBC.forEach((item, idx) => {
        document.getElementById('bet-bc-area').innerHTML += `<div style="background:#333; padding:10px; border-radius:10px; text-align:center;"><img src="https://cdn-icons-png.flaticon.com/512/${item.i}/${item.i}.png" style="width:40px;"><br><input type="number" id="in-bc-${idx}" style="width:80%;" placeholder="0"></div>`;
    });
    for(let i=0; i<4; i++) {
        document.getElementById('bet-dn-area').innerHTML += `<div style="background:#333; padding:10px; border-radius:10px; text-align:center;">ğŸ‡${i+1}<br><input type="number" id="in-dn-${i}" style="width:80%;" placeholder="0"></div>`;
    }

    // --- CORE LOGIC ---
    function changeScreen(s) {
        ['menu','bc','tx','xd','dn'].forEach(x => document.getElementById('screen-'+x).classList.add('hidden'));
        document.getElementById('screen-'+s).classList.remove('hidden');
        curScreen = s; document.getElementById('msg').innerText = "";
    }

    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function logout() { auth.signOut(); location.reload(); }

    auth.onAuthStateChanged(user => {
        if(user) {
            currentUser = user; document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('game-ui').classList.remove('hidden');
            document.getElementById('user-name').innerText = user.displayName;
            db.ref('online/'+user.uid).set({name:user.displayName, time: firebase.database.ServerValue.TIMESTAMP});
            db.ref('online/'+user.uid).onDisconnect().remove();
            db.ref('users/'+user.uid).on('value', s => { balance = s.val()?.bal || 2000; document.getElementById('balance').innerText = balance.toLocaleString(); });
        }
    });

    db.ref('online').orderByChild('time').on('value', s => {
        const list = document.getElementById('user-list'); list.innerHTML = ""; let users = [];
        s.forEach(c => { users.push(c.key); list.innerHTML += `<li>${c.val().name}</li>`; });
        document.getElementById('online-count').innerText = users.length;
        isHost = (users[0] === currentUser?.uid);
        document.getElementById('play-btn').classList.toggle('hidden', !isHost);
    });

    // --- GAME SYNC ---
    function masterPlay() {
        if(!isHost) return;
        const room = 'room_'+curScreen; let res = [];
        if(curScreen === 'bc') res = [Math.floor(Math.random()*6), Math.floor(Math.random()*6), Math.floor(Math.random()*6)];
        if(curScreen === 'tx') res = [Math.floor(Math.random()*6)+1, Math.floor(Math.random()*6)+1, Math.floor(Math.random()*6)+1];
        if(curScreen === 'xd') res = [Math.random()>0.5, Math.random()>0.5, Math.random()>0.5, Math.random()>0.5];
        if(curScreen === 'dn') { startRace(); return; }

        db.ref(room).update({status:'shaking'});
        setTimeout(() => db.ref(room).update({status:'ready', res: res, time: Date.now()}), 1500);
    }

    function startRace() {
        let pos = [0,0,0,0]; 
        let timer = setInterval(() => {
            pos = pos.map(p => p + Math.floor(Math.random()*10));
            if(pos.some(p => p>=90)) {
                clearInterval(timer); let win = pos.indexOf(Math.max(...pos));
                db.ref('room_dn').update({status:'ready', res: pos, win: win, time: Date.now()});
            } else { db.ref('room_dn').update({status:'shaking', res: pos}); }
        }, 300);
    }

    // --- LISTENEERS ---
    db.ref('room_bc').on('value', s => syncGame('bc', s.val()));
    db.ref('room_tx').on('value', s => syncGame('tx', s.val()));
    db.ref('room_xd').on('value', s => syncGame('xd', s.val()));
    db.ref('room_dn').on('value', s => syncGame('dn', s.val()));

    function syncGame(g, data) {
        if(!data || curScreen !== g) return;
        const board = document.getElementById('board-'+g);
        if(data.status === 'shaking') {
            if(!isHost) deduct(g);
            if(g==='bc') [0,1,2].forEach(i => document.getElementById('dice-bc-'+i).classList.add('shaking'));
            if(g==='dn') data.res.forEach((p,i) => document.getElementById('horse-'+i).style.left = p+'%');
        } else if(data.status === 'ready') {
            if(g==='bc') data.res.forEach((v,i) => { const el = document.getElementById('dice-bc-'+i); el.classList.remove('shaking'); el.src = `https://cdn-icons-png.flaticon.com/512/${itemsBC[v].i}/${itemsBC[v].i}.png`; });
            if(g==='tx') data.res.forEach((v,i) => { document.getElementById('dice-tx-'+i).src = `https://img.icons8.com/ios-filled/100/ffffff/dice-${['one','two','three','four','five','six'][v-1]}.png`; });
            if(g==='xd') data.res.forEach((v,i) => { const el = document.getElementById('dot-'+i); el.className = v ? 'xd-dot dot-red' : 'xd-dot dot-white'; });
            if(g==='dn') data.res.forEach((p,i) => document.getElementById('horse-'+i).style.left = p+'%');
            calcWin(g, data);
        }
    }

    function deduct(g) {
        let t = 0;
        if(g==='bc') for(let i=0;i<6;i++) { myBets.bc[i] = parseInt(document.getElementById('in-bc-'+i).value)||0; t+=myBets.bc[i]; }
        if(g==='tx') { const ty = myBets.tx.type; if(ty) { myBets.tx.val = parseInt(document.getElementById('val-'+ty).value)||0; t=myBets.tx.val; } }
        if(g==='xd') { const ty = myBets.xd.type; if(ty) { myBets.xd.val = parseInt(document.getElementById('val-'+ty).value)||0; t=myBets.xd.val; } }
        if(g==='dn') for(let i=0;i<4;i++) { myBets.dn[i] = parseInt(document.getElementById('in-dn-'+i).value)||0; t+=myBets.dn[i]; }
        if(t > 0 && t <= balance) db.ref('users/'+currentUser.uid).update({bal: balance - t});
    }

    function calcWin(g, data) {
        let w = 0;
        if(g==='bc') data.res.forEach(v => { if(myBets.bc[v]>0) w += myBets.bc[v]*2; });
        if(g==='tx') { const s = data.res.reduce((a,b)=>a+b,0); const r = s>=11?'tai':'xiu'; if(myBets.tx.type === r) w = myBets.tx.val*2; }
        if(g==='xd') { const r = data.res.filter(x=>x).length % 2 === 0 ? 'chan' : 'le'; if(myBets.xd.type === r) w = myBets.xd.val*2; }
        if(g==='dn') { if(myBets.dn[data.win]>0) w = myBets.dn[data.win]*4; }
        
        if(w>0) { db.ref('users/'+currentUser.uid).update({bal: balance + w}); document.getElementById('msg').innerText = "THáº®NG +"+w; }
        resetBets();
    }

    function resetBets() {
        myBets = { bc: [0,0,0,0,0,0], tx: {type:null, val:0}, xd: {type:null, val:0}, dn: [0,0,0,0] };
        document.querySelectorAll('input').forEach(i => i.value = "");
        document.querySelectorAll('.active-bet').forEach(e => e.classList.remove('active-bet'));
    }

    function selTX(t) { myBets.tx.type = t; document.getElementById('btn-tai').classList.remove('active-bet'); document.getElementById('btn-xiu').classList.remove('active-bet'); document.getElementById('btn-'+t).classList.add('active-bet'); }
    function selXD(t) { myBets.xd.type = t; document.getElementById('btn-chan').classList.remove('active-bet'); document.getElementById('btn-le').classList.remove('active-bet'); document.getElementById('btn-'+t).classList.add('active-bet'); }

    // --- CHAT ---
    function sendChat() { const i = document.getElementById('chat-input'); if(i.value) { db.ref('chat').push({n:currentUser.displayName, t:i.value, time:new Date().toLocaleTimeString()}); i.value=""; } }
    db.ref('chat').limitToLast(15).on('value', s => {
        const m = document.getElementById('chat-messages'); m.innerHTML = "";
        s.forEach(c => { m.innerHTML += `<div><span class="chat-time">[${c.val().time}]</span><b>${c.val().n}:</b> ${c.val().t}</div>`; });
        m.scrollTop = m.scrollHeight;
    });
</script>
</body>
</html>
