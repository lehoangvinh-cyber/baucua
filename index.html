<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Center Pro - v3.0</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <style>
        :root { --primary: #e53935; --gold: #ffc107; --bg: #0f0f0f; --card: #1e1e1e; --green: #2e7d32; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 10px; display: flex; justify-content: center; }
        
        /* Auth Container */
        .auth-container { background: var(--card); padding: 40px; border-radius: 24px; border: 1px solid #333; width: 360px; text-align: center; margin-top: 5vh; }
        .auth-container input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        .auth-container button { width: 100%; padding: 14px; background: var(--gold); border: none; border-radius: 12px; font-weight: 700; cursor: pointer; color: #000; }

        /* Game Layout */
        .app-container { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 1fr 340px; gap: 20px; }
        @media (max-width: 950px) { .app-container { grid-template-columns: 1fr; } }
        
        .main-content { background: var(--card); padding: 25px; border-radius: 24px; border: 1px solid #333; min-height: 650px; position: relative; }
        .nav-bar { display: flex; justify-content: space-between; align-items: center; background: #262626; padding: 15px 20px; border-radius: 16px; margin-bottom: 25px; }
        
        /* Game Assets */
        .dice-board { display: flex; justify-content: center; gap: 20px; margin: 30px 0; background: #262626; padding: 25px; border-radius: 20px; }
        .dice-board img { width: 75px; height: 75px; background: #fff; border-radius: 14px; padding: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .xd-dot { width: 35px; height: 35px; border-radius: 50%; border: 3px solid #111; }
        .red { background: #ff4444; } .white { background: #eeeeee; }

        /* Horse Racing */
        .track { background: var(--green); padding: 15px; border-radius: 16px; border: 4px solid #1b5e20; }
        .lane { height: 45px; border-bottom: 1px dashed rgba(255,255,255,0.15); position: relative; display: flex; align-items: center; }
        .horse { font-size: 28px; position: absolute; left: 0; transition: left 0.3s ease-out; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }

        /* Sidebar & Lists */
        .side-panel { display: flex; flex-direction: column; gap: 20px; }
        .side-box { background: var(--card); border-radius: 20px; border: 1px solid #333; overflow: hidden; }
        .side-header { background: #262626; padding: 12px 18px; font-weight: 700; color: var(--gold); font-size: 14px; }
        #chat-list, #hist-list { height: 280px; overflow-y: auto; padding: 15px; font-size: 13px; scrollbar-width: thin; scrollbar-color: var(--gold) #222; }
        #chat-list::-webkit-scrollbar { width: 6px; }
        #chat-list::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        /* General Utilities */
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .menu-btn { background: #262626; border: 1px solid #333; border-radius: 20px; padding: 30px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .menu-btn:hover { border-color: var(--gold); transform: translateY(-4px); }
        .menu-btn span { font-size: 48px; display: block; margin-bottom: 10px; color: var(--gold); }
        .hidden { display: none; }
        .shaking { animation: shake 0.15s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px) rotate(0deg); } 25% { transform: translate(-2px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } }
        #action-btn { width: 100%; padding: 18px; background: var(--primary); color: #fff; border: none; border-radius: 16px; font-weight: 700; font-size: 18px; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 0 #b71c1c; }
        #action-btn:active { box-shadow: none; transform: translateY(4px); }
        .active-bet { border: 2px solid var(--gold) !important; background: #333 !important; }
    </style>
</head>
<body>

<div id="auth-view" class="auth-container">
    <h1 style="color:var(--gold)">BEYOND GAME</h1>
    <div id="auth-form">
        <input type="text" id="reg-name" placeholder="TÃªn hiá»ƒn thá»‹" class="hidden">
        <input type="email" id="user-email" placeholder="Email">
        <input type="password" id="user-pass" placeholder="Máº­t kháº©u">
        <button onclick="processAuth()" id="main-auth-btn">ÄÄƒng Nháº­p</button>
        <p onclick="forgotPass()" style="color:var(--primary); font-size:12px">QuÃªn máº­t kháº©u?</p>
        <p onclick="swapAuth()" id="auth-swap-txt">ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½</p>
    </div>
</div>

<div id="app-view" class="app-container hidden">
    <div class="main-content">
        <div class="nav-bar">
            <div>ğŸ‘‹ <b id="display-name">...</b></div>
            <select id="play-mode" onchange="switchMode()" style="background:#000; color:#fff; border:1px solid #444; padding:6px; border-radius:8px;">
                <option value="multi">ğŸŒ ChÆ¡i Chung</option>
                <option value="solo">ğŸ‘¤ ChÆ¡i RiÃªng</option>
            </select>
            <div style="color:var(--gold); font-weight:700">ğŸ’° <span id="user-bal">0</span></div>
            <button onclick="exitGame()" style="background:none; color:#ff4444; border:none; cursor:pointer">ThoÃ¡t</button>
        </div>

        <div id="status-msg" style="text-align:center; height:30px; font-weight:700; color:var(--gold)"></div>

        <div id="view-menu" class="grid-menu">
            <div class="menu-btn" onclick="openGame('bc')"><span class="material-symbols-outlined">pets</span>Báº§u Cua</div>
            <div class="menu-btn" onclick="openGame('tx')"><span class="material-symbols-outlined">casino</span>TÃ i Xá»‰u</div>
            <div class="menu-btn" onclick="openGame('xd')"><span class="material-symbols-outlined">brightness_low</span>XÃ³c ÄÄ©a</div>
            <div class="menu-btn" onclick="openGame('dn')"><span class="material-symbols-outlined">bakery_dining</span>Äua Ngá»±a</div>
        </div>

        <div id="view-bc" class="hidden">
            <button onclick="openGame('menu')" style="color:#aaa; background:none; border:none; cursor:pointer">â† Quay láº¡i</button>
            <div class="dice-board" id="bc-board">
                <img id="dice-bc-0" src="https://img.icons8.com/color/144/help.png">
                <img id="dice-bc-1" src="https://img.icons8.com/color/144/help.png">
                <img id="dice-bc-2" src="https://img.icons8.com/color/144/help.png">
            </div>
            <div id="bc-bet-slots" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;"></div>
        </div>

        <div id="view-tx" class="hidden">
            <button onclick="openGame('menu')" style="color:#aaa; background:none; border:none; cursor:pointer">â† Quay láº¡i</button>
            <div class="dice-board">
                <img id="dice-tx-0" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
                <img id="dice-tx-1" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
                <img id="dice-tx-2" src="https://img.icons8.com/ios-filled/100/ffffff/dice-one.png">
            </div>
            <div style="display:flex; gap:15px">
                <div id="tx-tai" class="menu-btn" style="flex:1" onclick="pickTX('tai')"><h2>TÃ€I</h2><input type="number" id="bet-tai" placeholder="Tiá»n..." onclick="event.stopPropagation()"></div>
                <div id="tx-xiu" class="menu-btn" style="flex:1" onclick="pickTX('xiu')"><h2>Xá»ˆU</h2><input type="number" id="bet-xiu" placeholder="Tiá»n..." onclick="event.stopPropagation()"></div>
            </div>
        </div>

        <div id="view-xd" class="hidden">
            <button onclick="openGame('menu')" style="color:#aaa; background:none; border:none; cursor:pointer">â† Quay láº¡i</button>
            <div class="dice-board" id="xd-board" style="gap:25px">
                <div id="dot-0" class="xd-dot white"></div><div id="dot-1" class="xd-dot white"></div>
                <div id="dot-2" class="xd-dot white"></div><div id="dot-3" class="xd-dot white"></div>
            </div>
            <div style="display:flex; gap:15px">
                <div id="xd-chan" class="menu-btn" style="flex:1" onclick="pickXD('chan')"><h2>CHáº´N</h2><input type="number" id="bet-chan" placeholder="Tiá»n..."></div>
                <div id="xd-le" class="menu-btn" style="flex:1" onclick="pickXD('le')"><h2>Láºº</h2><input type="number" id="bet-le" placeholder="Tiá»n..."></div>
            </div>
        </div>

        <div id="view-dn" class="hidden">
            <button onclick="openGame('menu')" style="color:#aaa; background:none; border:none; cursor:pointer">â† Quay láº¡i</button>
            <div class="track" style="margin:20px 0;">
                <div class="lane"><div id="h-0" class="horse">ğŸ‡</div></div>
                <div class="lane"><div id="h-1" class="horse">ğŸ‡</div></div>
                <div class="lane"><div id="h-2" class="horse">ğŸ‡</div></div>
                <div class="lane"><div id="h-3" class="horse">ğŸ‡</div></div>
            </div>
            <div id="dn-bet-slots" style="display:grid; grid-template-columns:repeat(4, 1fr); gap:12px;"></div>
        </div>

        <button id="action-btn" class="hidden" onclick="runSession()">Báº®T Äáº¦U PHIÃŠN</button>
        <div id="wait-msg" class="hidden" style="text-align:center; padding:20px; color:#666; font-style:italic">Äang Ä‘á»£i phiÃªn chung báº¯t Ä‘áº§u...</div>
    </div>

    <div class="side-panel">
        <div class="side-box">
            <div class="side-header">ğŸ“œ Lá»ŠCH Sá»¬ CÃ NHÃ‚N</div>
            <div id="hist-list"></div>
        </div>
        <div class="side-box">
            <div class="side-header">ğŸ’¬ CHAT Tá»”NG</div>
            <div id="chat-list"></div>
            <div style="display:flex; padding:10px; gap:8px; background:#111">
                <input type="text" id="chat-input" placeholder="Nháº¯n tin..." style="flex:1; padding:10px; border-radius:8px; background:#222; border:none; color:#fff">
                <button onclick="postChat()" style="background:var(--gold); border:none; border-radius:8px; padding:0 15px; cursor:pointer; font-weight:700">></button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG (Cáº¦N ÄIá»€N THÃ”NG TIN Cá»¦A Báº N) ---
    const firebaseConfig = {
  apiKey: "AIzaSyA41b97JGMfwxG8YYeS6gpNREJDdNTm1zs",
  authDomain: "game-ddf58.firebaseapp.com",
  databaseURL: "https://game-ddf58-default-rtdb.firebaseio.com",
  projectId: "game-ddf58",
  storageBucket: "game-ddf58.firebasestorage.app",
  messagingSenderId: "1044515984576",
  appId: "1:1044515984576:web:dfe285553142875849c925",
  measurementId: "G-0Q7VVDPWRP"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.database();

    // --- SETUP BIáº¾N ---
    let curView = 'menu'; let balance = 0; let isHost = false; let currentUser = null; let isReg = false; let pMode = 'multi';
    let myBets = { bc: [0,0,0,0,0,0], tx: {type:null, val:0}, xd: {type:null, val:0}, dn: [0,0,0,0] };
    const bcItems = [{n:'Báº§u',i:'2329865'},{n:'Cua',i:'1046368'},{n:'TÃ´m',i:'2515183'},{n:'CÃ¡',i:'2271313'},{n:'GÃ ',i:'2632839'},{n:'Nai',i:'2395796'}];

    // Render Slots
    bcItems.forEach((it, idx) => {
        document.getElementById('bc-bet-slots').innerHTML += `<div style="background:#262626; padding:12px; border-radius:15px; text-align:center;"><img src="https://cdn-icons-png.flaticon.com/512/${it.i}/${it.i}.png" style="width:45px;"><br><input type="number" id="in-bc-${idx}" style="width:85%; background:#111; border:none; color:#fff; text-align:center; padding:5px; margin-top:5px" placeholder="0"></div>`;
    });
    for(let i=0; i<4; i++) {
        document.getElementById('dn-bet-slots').innerHTML += `<div style="background:#262626; padding:12px; border-radius:15px; text-align:center; font-weight:700">ğŸ‡ ${i+1}<br><input type="number" id="in-dn-${i}" style="width:85%; background:#111; border:none; color:#fff; text-align:center; padding:5px; margin-top:5px" placeholder="0"></div>`;
    }

    // --- XÃC THá»°C ---
    function swapAuth() {
        isReg = !isReg;
        document.getElementById('auth-title').innerText = isReg ? "ÄÄ‚NG KÃ" : "ÄÄ‚NG NHáº¬P";
        document.getElementById('main-auth-btn').innerText = isReg ? "Táº¡o TÃ i Khoáº£n" : "ÄÄƒng Nháº­p";
        document.getElementById('reg-name').classList.toggle('hidden', !isReg);
    }

    function processAuth() {
        const e = document.getElementById('user-email').value; const p = document.getElementById('user-pass').value; const n = document.getElementById('reg-name').value;
        if(isReg) auth.createUserWithEmailAndPassword(e, p).then(u => u.user.updateProfile({displayName: n})).then(() => location.reload()).catch(err => alert(err.message));
        else auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
    }

    auth.onAuthStateChanged(user => {
        if(user) {
            currentUser = user; document.getElementById('auth-view').classList.add('hidden'); document.getElementById('app-view').classList.remove('hidden');
            document.getElementById('display-name').innerText = user.displayName || user.email.split('@')[0];
            db.ref('users/'+user.uid).on('value', s => { 
                balance = s.val()?.bal || 2000; 
                if(!s.val()) db.ref('users/'+user.uid).set({bal: 2000});
                document.getElementById('user-bal').innerText = balance.toLocaleString(); 
            });
            // Láº¯ng nghe lá»‹ch sá»­ & Online
            db.ref('hist/'+user.uid).limitToLast(12).on('value', s => {
                const list = document.getElementById('hist-list'); list.innerHTML = ""; let a = []; s.forEach(c => a.unshift(c.val()));
                a.forEach(i => { list.innerHTML += `<div class="history-item"><span>[${i.t}] ${i.g}</span><b style="color:${i.a>0?'#4caf50':'#ff4444'}">${i.a>0?'+':''}${i.a}</b></div>`; });
            });
            db.ref('online/'+user.uid).set({name: user.displayName||user.email, t: Date.now()});
            db.ref('online/'+user.uid).onDisconnect().remove();
        }
    });

    // --- GAME ENGINE ---
    function openGame(s) {
        ['menu','bc','tx','xd','dn'].forEach(x => document.getElementById('view-'+x).classList.add('hidden'));
        document.getElementById('view-'+s).classList.remove('hidden'); curView = s; document.getElementById('status-msg').innerText = "";
        switchMode();
    }

    function switchMode() {
        pMode = document.getElementById('play-mode').value;
        if(pMode === 'solo') { document.getElementById('action-btn').classList.remove('hidden'); document.getElementById('wait-msg').classList.add('hidden'); }
        else syncRoom();
    }

    function syncRoom() {
        db.ref('online').orderByChild('t').on('value', s => {
            let us = []; s.forEach(c => us.push(c.key)); isHost = (us[0] === currentUser?.uid);
            if(pMode === 'multi') { document.getElementById('action-btn').classList.toggle('hidden', !isHost); document.getElementById('wait-msg').classList.toggle('hidden', isHost); }
        });
    }

    function runSession() {
        let t = getBetSum();
        if(t > balance) return alert("KhÃ´ng Ä‘á»§ xu!");
        if(pMode === 'solo') { payBet(curView); localRun(); }
        else {
            if(!isHost) return; payBet(curView);
            const r = 'room_'+curView; db.ref(r+'/sid').transaction(c => (c||0)+1);
            db.ref(r).update({st:'shaking'});
            setTimeout(() => db.ref(r).update({st:'ready', res: genRes(curView), t: Date.now()}), 1500);
        }
    }

    function localRun() {
        if(curView === 'dn') { runLocalRace(); return; }
        toggleShake(true);
        setTimeout(() => {
            toggleShake(false); let r = genRes(curView); renderRes(curView, r); finishVegas(curView, {res: r});
        }, 1500);
    }

    function toggleShake(on) { document.querySelectorAll('#view-'+curView+' img, #xd-board').forEach(i => i.classList.toggle('shaking', on)); }

    function genRes(g) {
        if(g==='bc') return [rnd(6), rnd(6), rnd(6)];
        if(g==='tx') return [rnd(6)+1, rnd(6)+1, rnd(6)+1];
        if(g==='xd') return [Math.random()>0.5, Math.random()>0.5, Math.random()>0.5, Math.random()>0.5];
        return [];
    }

    function payBet(g) {
        let t = getBetSum();
        if(t > 0) {
            if(g==='bc') for(let i=0;i<6;i++) myBets.bc[i] = parseInt(document.getElementById('in-bc-'+i).value)||0;
            if(g==='tx') myBets.tx.val = t;
            if(g==='xd') myBets.xd.val = t;
            if(g==='dn') for(let i=0;i<4;i++) myBets.dn[i] = parseInt(document.getElementById('in-dn-'+i).value)||0;
            db.ref('users/'+currentUser.uid).update({bal: balance - t}); logHist(g, -t);
        }
    }

    function finishVegas(g, data) {
        let w = 0;
        if(g==='bc') data.res.forEach(v => { if(myBets.bc[v]>0) w += myBets.bc[v]*2; });
        if(g==='tx') { const s = data.res.reduce((a,b)=>a+b,0), r = s>=11?'tai':'xiu'; if(myBets.tx.type === r) w = myBets.tx.val*2; }
        if(g==='xd') { const r = data.res.filter(x=>x).length % 2 === 0 ? 'chan':'le'; if(myBets.xd.type === r) w = myBets.xd.val*2; }
        if(g==='dn') { if(myBets.dn[data.win]>0) w = myBets.dn[data.win]*4; }
        if(w > 0) { db.ref('users/'+currentUser.uid).update({bal: balance + w}); logHist(g, w); document.getElementById('status-msg').innerText = "THáº®NG +"+w; }
        clearBets();
    }

    function renderRes(g, r) {
        if(g==='bc') r.forEach((v,i) => document.getElementById('dice-bc-'+i).src = `https://cdn-icons-png.flaticon.com/512/${bcItems[v].i}/${bcItems[v].i}.png`);
        if(g==='tx') r.forEach((v,i) => document.getElementById('dice-tx-'+i).src = `https://img.icons8.com/ios-filled/100/ffffff/dice-${['one','two','three','four','five','six'][v-1]}.png`);
        if(g==='xd') r.forEach((v,i) => document.getElementById('dot-'+i).className = v ? 'xd-dot red' : 'xd-dot white');
    }

    // Helpers
    function rnd(n) { return Math.floor(Math.random()*n); }
    function logHist(g, a) { const t = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); db.ref('hist/'+currentUser.uid).push({g: g.toUpperCase(), a: a, t: t}); }
    function getBetSum() {
        let t = 0;
        if(curView==='bc') for(let i=0;i<6;i++) t += parseInt(document.getElementById('in-bc-'+i).value)||0;
        if(curView==='tx') t = parseInt(document.getElementById('bet-'+myBets.tx.type)?.value)||0;
        if(curView==='xd') t = parseInt(document.getElementById('bet-'+myBets.xd.type)?.value)||0;
        if(curView==='dn') for(let i=0;i<4;i++) t += parseInt(document.getElementById('in-dn-'+i).value)||0;
        return t;
    }
    function clearBets() { myBets = { bc: [0,0,0,0,0,0], tx: {type:null, val:0}, xd: {type:null, val:0}, dn: [0,0,0,0] }; document.querySelectorAll('input').forEach(i => { if(i.id.includes('in-') || i.id.includes('bet-')) i.value = ""; }); document.querySelectorAll('.active-bet').forEach(e => e.classList.remove('active-bet')); }

    // --- SYNC MULTI ---
    ['bc','tx','xd','dn'].forEach(g => {
        db.ref('room_'+g).on('value', s => {
            const d = s.val(); if(!d || curView !== g || pMode === 'solo') return;
            if(d.st === 'shaking') { if(!isHost) payBet(g); toggleShake(true); }
            else if(d.st === 'ready') { toggleShake(false); renderRes(g, d.res); finishVegas(g, d); }
        });
    });

    // Chat
    function postChat() { const i = document.getElementById('chat-input'); if(i.value) { db.ref('chat').push({n:currentUser.displayName, t:i.value, ts:Date.now()}); i.value=""; } }
    db.ref('chat').limitToLast(12).on('value', s => {
        const m = document.getElementById('chat-list'); m.innerHTML = "";
        s.forEach(c => { m.innerHTML += `<div style="margin-bottom:8px"><b>${c.val().n}:</b> ${c.val().t}</div>`; });
        m.scrollTop = m.scrollHeight;
    });

    function pickTX(t) { myBets.tx.type = t; document.querySelectorAll('#view-tx .menu-btn').forEach(e => e.classList.remove('active-bet')); document.getElementById('tx-'+t).classList.add('active-bet'); }
    function pickXD(t) { myBets.xd.type = t; document.querySelectorAll('#view-xd .menu-btn').forEach(e => e.classList.remove('active-bet')); document.getElementById('xd-'+t).classList.add('active-bet'); }
</script>
</body>
</html>
